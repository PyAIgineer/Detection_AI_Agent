<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Detection Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg:         #f0f4ff;
            --surface:    #ffffff;
            --surface2:   #f7f9ff;
            --sidebar-bg: #1e2d5a;
            --accent:     #3d5af1;
            --accent2:    #00c2a8;
            --accent3:    #f7634d;
            --accent4:    #f5a623;
            --text:       #1a1f36;
            --muted:      #6b7a99;
            --border:     #e2e8f8;
            --online:     #00c48c;
            --offline:    #f7634d;
            --warn:       #f5a623;
            --shadow:     0 4px 20px rgba(61,90,241,0.09);
            --shadow-lg:  0 8px 36px rgba(61,90,241,0.15);
            --r:          14px;
            --rs:         8px;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            width: 70px;
            background: var(--sidebar-bg);
            display: flex; flex-direction: column; align-items: center;
            padding: 18px 0; gap: 4px; flex-shrink: 0;
            box-shadow: 4px 0 20px rgba(0,0,0,0.13);
            z-index: 100;
        }
        .logo {
            width: 40px; height: 40px; background: var(--accent);
            border-radius: 11px; display: flex; align-items: center;
            justify-content: center; font-size: 1.3em; margin-bottom: 18px;
            box-shadow: 0 4px 14px rgba(61,90,241,0.42);
        }
        .nav { display: flex; flex-direction: column; gap: 3px; width: 100%; padding: 0 9px; }
        .ni {
            width: 52px; height: 52px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: rgba(255,255,255,0.4); font-size: 1.25em;
            transition: all 0.18s; position: relative;
        }
        .ni:hover { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.85); }
        .ni.active { background: var(--accent); color: #fff; box-shadow: 0 4px 14px rgba(61,90,241,0.42); }
        .tip {
            position: absolute; left: 60px; background: #1e2d5a; color: #fff;
            padding: 5px 11px; border-radius: 6px; font-size: 0.74em; font-weight: 600;
            white-space: nowrap; pointer-events: none; opacity: 0; transition: opacity 0.18s; z-index: 300;
        }
        .ni:hover .tip { opacity: 1; }
        .sb-bottom {
            margin-top: auto; display: flex; flex-direction: column;
            align-items: center; gap: 12px; padding-bottom: 4px;
        }
        .notif {
            width: 34px; height: 34px; border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(255,255,255,0.07);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.95em; color: rgba(255,255,255,0.55); position: relative; cursor: pointer;
        }
        .ndot {
            position: absolute; top: 5px; right: 5px; width: 8px; height: 8px;
            background: var(--accent3); border-radius: 50%; border: 2px solid var(--sidebar-bg);
        }
        .avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: 700; font-size: 0.85em;
            border: 2px solid rgba(255,255,255,0.18); cursor: pointer;
        }

        /* ========== CAMERA LIST ========== */
        .camlist {
            width: 220px; background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .cl-head { padding: 18px 16px 13px; border-bottom: 1px solid var(--border); }
        .cl-head h3 { font-size: 0.95em; font-weight: 700; margin-bottom: 10px; }
        .searchbox {
            display: flex; align-items: center; gap: 7px;
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: var(--rs); padding: 7px 11px;
        }
        .searchbox input {
            border: none; background: transparent; font-family: inherit;
            font-size: 0.8em; color: var(--text); outline: none; width: 100%;
        }
        .searchbox input::placeholder { color: var(--muted); }
        .cl-scroll { overflow-y: auto; flex: 1; padding: 6px 9px; }
        .cl-scroll::-webkit-scrollbar { width: 3px; }
        .cl-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
        .grplabel {
            font-size: 0.68em; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.08em; color: var(--muted); padding: 9px 7px 3px;
        }
        .citem {
            display: flex; align-items: center; gap: 9px;
            padding: 8px 9px; border-radius: var(--rs);
            cursor: pointer; transition: background 0.13s;
        }
        .citem:hover { background: var(--surface2); }
        .citem.active { background: #eef1ff; }
        .dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
        .dot.on  { background: var(--online); box-shadow: 0 0 5px rgba(0,196,140,0.55); }
        .dot.off { background: var(--offline); }
        .dot.wn  { background: var(--warn); box-shadow: 0 0 5px rgba(245,166,35,0.55); }
        .cname { font-size: 0.8em; font-weight: 500; flex: 1; }

        /* ========== MAIN ========== */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0; }

        /* TOPBAR */
        .topbar {
            height: 60px; background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 22px; gap: 14px; flex-shrink: 0;
        }
        .tb-title { font-size: 1em; font-weight: 700; }
        .tb-date {
            display: flex; align-items: center; gap: 7px;
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: var(--rs); padding: 5px 13px;
            font-size: 0.8em; color: var(--muted); font-weight: 500;
        }
        .tb-spacer { flex: 1; }
        .grid-btns { display: flex; gap: 4px; }
        .gb {
            width: 30px; height: 30px; border-radius: 6px;
            border: 1px solid var(--border); background: var(--surface);
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 0.85em; color: var(--muted); transition: all 0.14s;
        }
        .gb.active, .gb:hover { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* ========== TAB CONTENT ========== */
        .tab { display: none; flex: 1; overflow: hidden; }
        .tab.active { display: flex; flex-direction: column; overflow: hidden; }

        /* ========== MONITORING TAB ========== */
        .mon-scroll {
            flex: 1; overflow-y: auto; padding: 18px 20px;
        }
        .mon-scroll::-webkit-scrollbar { width: 5px; }
        .mon-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        /* Grid: cameras + upload tile together */
        .feed-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }
        .feed-grid.g3 { grid-template-columns: repeat(3, 1fr); }
        .feed-grid.g1 { grid-template-columns: 1fr; }

        /* Camera feed tile */
        .cam-tile {
            background: #1a1f36;
            border-radius: var(--r);
            overflow: hidden; position: relative;
            aspect-ratio: 16/10;
            cursor: pointer;
            transition: transform 0.18s, box-shadow 0.18s;
            box-shadow: var(--shadow);
        }
        .cam-tile:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .cam-placeholder {
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #1e2d5a 0%, #263666 100%);
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; gap: 9px; color: rgba(255,255,255,0.22);
        }
        .cam-placeholder .big { font-size: 2.4em; }
        .cam-placeholder p { font-size: 0.78em; font-weight: 500; }
        .cam-bar {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 9px 13px;
            background: linear-gradient(to top, rgba(0,0,0,0.72) 0%, transparent 100%);
            display: flex; align-items: center; justify-content: space-between;
        }
        .cam-label {
            font-size: 0.76em; font-weight: 600; color: #fff;
            display: flex; align-items: center; gap: 6px;
        }
        .live-badge {
            font-size: 0.62em; font-weight: 700; padding: 2px 6px;
            border-radius: 4px; letter-spacing: 0.04em;
            animation: blink 2s infinite;
        }
        .lb-live    { background: var(--accent3); color: #fff; }
        .lb-warn    { background: var(--warn); color: #fff; }
        .lb-offline { background: #555; color: #ccc; }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.5} }
        .gear-btn { color: rgba(255,255,255,0.5); font-size: 0.85em; cursor: pointer; }
        .gear-btn:hover { color: #fff; }
        .alert-pin {
            position: absolute; top: 9px; right: 9px;
            background: var(--accent3); color: #fff;
            font-size: 0.68em; font-weight: 700; padding: 3px 8px;
            border-radius: 18px; box-shadow: 0 2px 8px rgba(247,99,77,0.4);
        }

        /* ========== UPLOAD TILE (same aspect as cam tile) ========== */
        .upload-tile {
            aspect-ratio: 16/10;
            border-radius: var(--r);
            background: var(--surface);
            border: 2px dashed var(--border);
            display: flex; flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: border-color 0.18s, box-shadow 0.18s;
        }
        .upload-tile:hover { border-color: var(--accent); box-shadow: var(--shadow-lg); }
        .upload-tile.dragover { border-color: var(--accent); background: #eef1ff; }

        .ut-inner {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 16px 20px; gap: 10px; cursor: pointer;
            text-align: center;
        }
        .ut-icon { font-size: 2.4em; }
        .ut-text { font-size: 0.82em; color: var(--muted); line-height: 1.5; }
        .ut-text strong { color: var(--text); font-weight: 600; }
        .ut-formats { font-size: 0.72em; color: var(--muted); }
        input[type="file"] { display: none; }

        .ut-footer {
            border-top: 1px solid var(--border);
            padding: 10px 14px;
            display: flex; gap: 8px; background: var(--surface2);
        }
        .btn {
            flex: 1; padding: 9px 12px;
            border-radius: var(--rs); border: none;
            font-family: inherit; font-size: 0.82em; font-weight: 600;
            cursor: pointer; transition: all 0.16s;
            display: inline-flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-p { background: var(--accent); color: #fff; box-shadow: 0 3px 12px rgba(61,90,241,0.28); }
        .btn-p:hover { background: #3149d4; }
        .btn-p:disabled { background: #c5cbdf; box-shadow: none; cursor: not-allowed; }
        .btn-d { background: var(--accent3); color: #fff; }
        .btn-d:hover { background: #e8452d; }
        .btn-d:disabled { background: #c5cbdf; cursor: not-allowed; }
        .btn-s { background: var(--accent2); color: #fff; }
        .btn-s:hover { background: #00a891; }
        .btn-sm-danger {
            padding: 7px 13px; border-radius: var(--rs); border: none;
            font-family: inherit; font-size: 0.76em; font-weight: 600;
            cursor: pointer; background: var(--accent3); color: #fff;
            display: inline-flex; align-items: center; gap: 4px;
        }
        .btn-sm-danger:hover { background: #e8452d; }

        /* ========== STATUS BADGES ========== */
        .sbadge {
            display: inline-flex; align-items: center; padding: 2px 9px;
            border-radius: 18px; font-size: 0.76em; font-weight: 700;
        }
        .s-pending   { background: #fff8e6; color: #b07800; }
        .s-running   { background: #eef1ff; color: var(--accent); }
        .s-completed { background: #e6faf5; color: #007a5e; }
        .s-failed    { background: #fff0ee; color: #c0321d; }
        .s-stopped   { background: #fff3e6; color: #b05a00; }

        .dtag { display: inline-flex; background: #e6faf5; color: #007a5e; padding: 2px 7px; border-radius: 11px; font-size: 0.74em; font-weight: 600; margin: 1px 2px; }
        .mtag { display: inline-flex; background: #eef1ff; color: var(--accent); padding: 2px 7px; border-radius: 11px; font-size: 0.74em; font-weight: 600; margin: 1px 2px; }

        /* ========== ANALYTICS TAB ========== */
        .analytics-scroll {
            flex: 1; overflow-y: auto; padding: 22px;
            display: flex; flex-direction: column; gap: 18px;
        }
        .analytics-scroll::-webkit-scrollbar { width: 5px; }
        .analytics-scroll::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        .card {
            background: var(--surface); border-radius: var(--r);
            padding: 18px 20px; box-shadow: var(--shadow); border: 1px solid var(--border);
        }
        .card-head {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 14px; gap: 8px;
        }
        .card-head-left { display: flex; align-items: center; gap: 8px; font-size: 0.92em; font-weight: 700; }
        .cicon { width: 26px; height: 26px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 0.85em; }
        .ci-b { background: #eef1ff; }
        .ci-g { background: #e6faf5; }
        .ci-o { background: #fff8e6; }

        .stats-row { display: grid; grid-template-columns: repeat(3,1fr); gap: 13px; }
        .scard {
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: var(--rs); padding: 15px 17px; position: relative; overflow: hidden;
        }
        .scard::before { content:''; position:absolute; top:0;left:0;right:0; height:3px; }
        .sc-b::before { background: var(--accent); }
        .sc-g::before { background: var(--accent2); }
        .sc-r::before { background: var(--accent3); }
        .sval { font-size: 1.9em; font-weight: 700; line-height: 1; font-family: 'DM Mono', monospace; }
        .slbl { font-size: 0.73em; color: var(--muted); margin-top: 5px; font-weight: 500; }

        .a2col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .col-full { grid-column: 1/-1; }
        .chart-wrap { position: relative; height: 230px; margin-top: 8px; }

        /* Logs in analytics */
        .logs-box {
            background: #0f172a; color: #94a3b8;
            padding: 12px 16px; border-radius: var(--rs);
            font-family: 'DM Mono', monospace; font-size: 0.76em;
            height: 260px; overflow-y: auto; line-height: 1.65;
            border: 1px solid #1e293b;
        }
        .logs-box::-webkit-scrollbar { width: 4px; }
        .logs-box::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 2px; }
        .le { margin-bottom: 1px; }
        .ln  { color: #94a3b8; }
        .lc  { color: #7dd3fc; }
        .lab { color: #c4b5fd; }
        .la  { color: #fdba74; }
        .ld  { color: #86efac; }
        .lp  { color: #fde68a; }
        .ls  { color: #fde68a; font-weight: bold; }
        .le2 { color: #fca5a5; }
        .lsuc{ color: #6ee7b7; font-weight: bold; }
        .lw  { color: #fdba74; }
        .ldiv{ color: #1e293b; }

        /* Task status block inside analytics */
        .task-block {
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: var(--rs); padding: 12px 14px;
        }
        .trow { display: flex; align-items: flex-start; gap: 8px; font-size: 0.8em; margin-bottom: 6px; flex-wrap: wrap; }
        .trow:last-child { margin-bottom: 0; }
        .tlbl { color: var(--muted); font-weight: 600; min-width: 60px; flex-shrink: 0; }

        /* History table */
        .htable { width: 100%; border-collapse: collapse; font-size: 0.8em; }
        .htable th {
            background: var(--surface2); color: var(--muted); font-weight: 600;
            padding: 9px 13px; text-align: left; border-bottom: 1px solid var(--border);
            font-size: 0.74em; text-transform: uppercase; letter-spacing: 0.04em;
        }
        .htable td { padding: 9px 13px; border-bottom: 1px solid var(--border); }
        .htable tr:hover td { background: var(--surface2); }
        .htable code {
            background: var(--surface2); border: 1px solid var(--border);
            padding: 2px 5px; border-radius: 4px; font-family: 'DM Mono', monospace;
            font-size: 0.87em; color: var(--accent);
        }

        /* Video preview */
        .vid-prev { width: 100%; border-radius: var(--rs); margin-top: 8px; }

        .hidden { display: none !important; }

        @media (max-width: 960px) {
            .camlist { display: none; }
            .feed-grid { grid-template-columns: 1fr; }
            .a2col { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- ========== SIDEBAR ========== -->
<div class="sidebar">
    <div class="logo">üéØ</div>
    <nav class="nav">
        <div class="ni active" onclick="switchTab('live')" id="nav-live">
            üì∑ <span class="tip">Live Monitoring</span>
        </div>
        <div class="ni" onclick="switchTab('analytics')" id="nav-analytics">
            üìä <span class="tip">Analytics</span>
        </div>
        <div class="ni" style="margin-top:8px;">
            üó∫Ô∏è <span class="tip">Map View</span>
        </div>
        <div class="ni">
            ‚öôÔ∏è <span class="tip">Settings</span>
        </div>
    </nav>
    <div class="sb-bottom">
        <div class="notif">üîî<div class="ndot"></div></div>
        <div class="avatar">AD</div>
    </div>
</div>

<!-- ========== CAMERA LIST ========== -->
<div class="camlist">
    <div class="cl-head">
        <h3>Cameras</h3>
        <div class="searchbox">
            <span style="color:var(--muted);font-size:0.83em;">üîç</span>
            <input type="text" placeholder="Search camera..." oninput="filterCams(this.value)">
        </div>
    </div>
    <div class="cl-scroll" id="camListEl">
        <div class="grplabel">Main Entrance</div>
        <div class="citem active"><div class="dot on"></div><span class="cname">CCTV 01</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 02</span></div>
        <div class="citem"><div class="dot wn"></div><span class="cname">CCTV 03</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 04</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 05</span></div>
        <div class="citem"><div class="dot off"></div><span class="cname">CCTV 06</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 07</span></div>
        <div class="grplabel">Office Area</div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 08</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 09</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 10</span></div>
        <div class="grplabel">Server Room</div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 11</span></div>
        <div class="citem"><div class="dot wn"></div><span class="cname">CCTV 12</span></div>
        <div class="grplabel">Parking Area</div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 13</span></div>
        <div class="citem"><div class="dot on"></div><span class="cname">CCTV 14</span></div>
        <div class="citem"><div class="dot off"></div><span class="cname">CCTV 15</span></div>
    </div>
</div>

<!-- ========== MAIN ========== -->
<div class="main">

    <!-- TOPBAR -->
    <div class="topbar">
        <span class="tb-title" id="tabTitle">Live Monitoring</span>
        <div class="tb-date">
            üìÖ <span id="liveDate"></span>&nbsp;&nbsp;
            üïê <span id="liveClock"></span>
        </div>
        <div class="tb-spacer"></div>
        <div class="grid-btns" id="gridToggle">
            <button class="gb" onclick="setGrid(1)" title="1 col">‚ñ£</button>
            <button class="gb active" onclick="setGrid(2)" title="2√ó2">‚äû</button>
            <button class="gb" onclick="setGrid(3)" title="3√ó3">‚äü</button>
        </div>
    </div>

    <!-- ======= TAB: LIVE MONITORING ======= -->
    <div class="tab active" id="tab-live">
        <div class="mon-scroll">
            <div class="feed-grid" id="feedGrid">

                <!-- CAM 01 -->
                <div class="cam-tile">
                    <div class="cam-placeholder"><div class="big">üìπ</div><p>CCTV 01 ‚Äî Live</p></div>
                    <div class="alert-pin">‚ö† Motion</div>
                    <div class="cam-bar">
                        <span class="cam-label"><span class="dot on"></span>CCTV 01 ‚Äî Main Entrance<span class="live-badge lb-live">LIVE</span></span>
                        <span class="gear-btn">‚öô</span>
                    </div>
                </div>

                <!-- CAM 02 -->
                <div class="cam-tile">
                    <div class="cam-placeholder"><div class="big">üìπ</div><p>CCTV 02 ‚Äî Live</p></div>
                    <div class="cam-bar">
                        <span class="cam-label"><span class="dot on"></span>CCTV 02 ‚Äî Main Entrance<span class="live-badge lb-live">LIVE</span></span>
                        <span class="gear-btn">‚öô</span>
                    </div>
                </div>

                <!-- CAM 03 -->
                <div class="cam-tile">
                    <div class="cam-placeholder"><div class="big">üìπ</div><p>CCTV 03 ‚Äî Warning</p></div>
                    <div class="cam-bar">
                        <span class="cam-label"><span class="dot wn"></span>CCTV 03 ‚Äî Office Area<span class="live-badge lb-warn">WARN</span></span>
                        <span class="gear-btn">‚öô</span>
                    </div>
                </div>

                <!-- CAM 04 -->
                <div class="cam-tile">
                    <div class="cam-placeholder"><div class="big">üìπ</div><p>CCTV 04 ‚Äî Live</p></div>
                    <div class="cam-bar">
                        <span class="cam-label"><span class="dot on"></span>CCTV 04 ‚Äî Office Area<span class="live-badge lb-live">LIVE</span></span>
                        <span class="gear-btn">‚öô</span>
                    </div>
                </div>

                <!-- CAM 05 -->
                <div class="cam-tile">
                    <div class="cam-placeholder"><div class="big">üìπ</div><p>CCTV 05 ‚Äî Live</p></div>
                    <div class="cam-bar">
                        <span class="cam-label"><span class="dot on"></span>CCTV 05 ‚Äî Server Room<span class="live-badge lb-live">LIVE</span></span>
                        <span class="gear-btn">‚öô</span>
                    </div>
                </div>

                <!-- CAM 06 OFFLINE -->
                <div class="cam-tile">
                    <div class="cam-placeholder" style="opacity:0.4;"><div class="big">üî¥</div><p>CCTV 06 ‚Äî Offline</p></div>
                    <div class="cam-bar">
                        <span class="cam-label"><span class="dot off"></span>CCTV 06 ‚Äî Parking<span class="live-badge lb-offline">OFFLINE</span></span>
                        <span class="gear-btn">‚öô</span>
                    </div>
                </div>

                <!-- ===== UPLOAD & DETECT TILE (same size as camera) ===== -->
                <div class="upload-tile" id="uploadTile">
                    <div class="ut-inner" id="uploadZone">
                        <div class="ut-icon">üì§</div>
                        <div class="ut-text" id="uploadText">
                            <strong>Upload Video for Detection</strong><br>
                            Click or drag a video file here
                        </div>
                        <div class="ut-formats">MP4 ¬∑ AVI ¬∑ MOV ¬∑ MKV</div>
                        <input type="file" id="fileInput" accept="video/*">
                    </div>
                    <div class="ut-footer">
                        <button class="btn btn-p" id="predictBtn" disabled>‚ñ∂ Start Detection</button>
                        <button class="btn btn-d" id="stopBtn" disabled>‚èπ Stop</button>
                    </div>
                </div>

            </div><!-- /feedGrid -->
        </div>
    </div>

    <!-- ======= TAB: ANALYTICS ======= -->
    <div class="tab" id="tab-analytics">
        <div class="analytics-scroll">

            <!-- Stats row -->
            <div class="stats-row">
                <div class="scard sc-b">
                    <div class="sval" id="totalDetections">0</div>
                    <div class="slbl">Total Detections</div>
                </div>
                <div class="scard sc-g">
                    <div class="sval" id="successRate">0%</div>
                    <div class="slbl">Success Rate</div>
                </div>
                <div class="scard sc-r">
                    <div class="sval" id="activeTasks">0</div>
                    <div class="slbl">Active Tasks</div>
                </div>
            </div>

            <!-- Task status + logs row -->
            <div class="a2col">

                <!-- Current task status -->
                <div class="card">
                    <div class="card-head">
                        <div class="card-head-left"><div class="cicon ci-b">üìã</div>Task Status</div>
                    </div>
                    <div id="currentTask">
                        <div class="task-block">
                            <div class="trow">
                                <span class="tlbl">Task ID</span>
                                <code id="taskId" style="font-size:0.8em;word-break:break-all;font-family:'DM Mono',monospace;">‚Äî</code>
                            </div>
                            <div class="trow">
                                <span class="tlbl">Status</span>
                                <span id="taskStatus"><span class="sbadge s-pending">IDLE</span></span>
                            </div>
                            <div id="classifierResult" class="hidden">
                                <div class="trow">
                                    <span class="tlbl">Detected</span>
                                    <span id="detectedItems"></span>
                                </div>
                                <div class="trow">
                                    <span class="tlbl">Models</span>
                                    <span id="selectedModels"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Output video (appears after completion) -->
                    <div id="outputSection" class="hidden" style="margin-top:14px;">
                        <div style="font-size:0.82em;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:6px;"><div class="cicon ci-g" style="width:22px;height:22px;font-size:0.75em;">üé¨</div>Detection Output</div>
                        <video id="outputVideo" class="vid-prev" controls></video>
                        <div style="margin-top:8px;">
                            <button class="btn btn-s" id="downloadBtn" style="flex:unset;width:100%;">‚¨á Download Output</button>
                        </div>
                    </div>
                </div>

                <!-- Real-time logs -->
                <div class="card">
                    <div class="card-head">
                        <div class="card-head-left"><div class="cicon ci-b">üìù</div>Real-time Logs</div>
                    </div>
                    <div class="logs-box" id="logsContainer">
                        <div class="le ln">Waiting for detection task...</div>
                    </div>
                </div>

                <!-- Model usage chart -->
                <div class="card">
                    <div class="card-head">
                        <div class="card-head-left"><div class="cicon ci-b">üìä</div>Model Usage</div>
                    </div>
                    <div class="chart-wrap">
                        <canvas id="modelUsageChart"></canvas>
                    </div>
                </div>

                <!-- Detection summary -->
                <div class="card">
                    <div class="card-head">
                        <div class="card-head-left"><div class="cicon ci-g">üìà</div>Detection Summary</div>
                    </div>
                    <p style="color:var(--muted);font-size:0.84em;margin-top:6px;">Run detections to see summary trends here.</p>
                </div>

                <!-- History table ‚Äî full width -->
                <div class="card col-full">
                    <div class="card-head">
                        <div class="card-head-left"><div class="cicon ci-o">üóÇÔ∏è</div>Detection History</div>
                        <button class="btn-sm-danger" id="clearHistoryBtn">üóë Clear</button>
                    </div>
                    <div style="overflow-x:auto;">
                        <table class="htable">
                            <thead>
                                <tr>
                                    <th>Task ID</th><th>Video</th><th>Status</th>
                                    <th>Detected</th><th>Models</th><th>Completed At</th>
                                </tr>
                            </thead>
                            <tbody id="historyBody">
                                <tr><td colspan="6" style="text-align:center;color:var(--muted);padding:28px;">No detection history yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div><!-- /main -->

<script src="/static/dashboard.js"></script>
<script>
    // Tab switching
    function switchTab(name) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.ni[id^="nav-"]').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active');
        const el = document.getElementById('nav-' + name);
        if (el) el.classList.add('active');
        document.getElementById('tabTitle').textContent = { live:'Live Monitoring', analytics:'Analytics' }[name] || name;
        document.getElementById('gridToggle').style.display = name === 'live' ? 'flex' : 'none';
    }

    // Grid toggle
    function setGrid(cols) {
        const g = document.getElementById('feedGrid');
        g.className = 'feed-grid' + (cols===3?' g3':cols===1?' g1':'');
        document.querySelectorAll('.gb').forEach((b,i) => b.classList.toggle('active',[1,2,3][i]===cols));
    }

    // Clock
    function tick() {
        const n = new Date();
        document.getElementById('liveClock').textContent = n.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
        document.getElementById('liveDate').textContent  = n.toLocaleDateString('en-US',{weekday:'short',day:'2-digit',month:'long',year:'numeric'});
    }
    tick(); setInterval(tick, 1000);

    // Camera search
    function filterCams(q) {
        document.querySelectorAll('.citem').forEach(el => {
            el.style.display = el.querySelector('.cname').textContent.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
        });
    }

    document.getElementById('gridToggle').style.display = 'flex';
</script>
</body>
</html>